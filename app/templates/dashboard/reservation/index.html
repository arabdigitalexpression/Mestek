{% extends 'dashboard/base.html' %} {% block title %} الحجوزات {% endblock %} {%
block heading %} الحجوزات {% endblock %} {% block actions %}
<div class="d-flex flex-row">
	<a
		class="btn btn-dark btn-sm rounded-0 d-flex align-items-center me-2"
		type="button"
		href="{{url_for('dashboard.reservation.create_reservation')}}"
	>
		<i class="bi bi-plus-circle me-1"></i>
		<span class=""> حجز مساحة </span>
	</a>
	<a
		class="btn btn-dark btn-sm rounded-0 d-flex align-items-center"
		type="button"
		href="{{url_for('dashboard.reservation.create_reservation_tool')}}"
	>
		<i class="bi bi-plus-circle me-1"></i>
		<span class=""> حجز أداة </span>
	</a>
</div>

{% endblock %} {% block content %}
<div class="table-responsive">
	<table
		class="table align-middle table-light table-striped table-hover table-sm"
	>
		<thead>
			<tr>
				<th scope="col">#</th>
				<th scope="col">نوع الحجز</th>
				<th scope="col">حجز لـ</th>
				<th scope="col" class="text-center">الدفع النقدى</th>
				<th scope="col">التاريخ</th>
				<th scope="col">اسم المالك</th>
				<th scope="col">قيمة الحجز</th>
				<th scope="col">إعدادات التحكم</th>
			</tr>
		</thead>
		<tbody>
			
			{% for reservation in reservations %}
			{% if loop.index <= j and loop.index >= i%}
			<tr>
				<td>{{loop.index }}</td>
				<td>
					{% if reservation.type.name == 'tool' %} أداة {% else %} مساحة {%
					endif %}
				</td>
				<td>
					{% if reservation.type.name == 'tool' %} {{reservation.tool.name}} {%
					else %} {{reservation.space.name}} {% endif %}
				</td>
				<td class="text-center">
					{% if reservation.payment_status.name == 'no_payment' %}<span
						class="badge rounded-0 text-bg-danger"
						>حجز غير مدفوع</span
					>
					{% elif reservation.payment_status.name == 'down_payment' %}
					<span class="badge rounded-0 text-bg-warning">حجز مدفوع جزئيا</span>
					{% else %}
					<span class="badge rounded-0 text-bg-success">حجز مدفوع</span>
					{% endif %}
				</td>
				<td>{{reservation.created_at}}</td>
				<td>
					{{ reservation.user.first_name + ' ' +reservation.user.last_name }}
				</td>
				<td>{{ reservation.full_price }} جنيه مصرى</td>
				<td class="d-flex">
					<button
						type="button"
						class="btn btn-info text-white btn-sm mx-1 rounded-0"
						data-bs-toggle="modal"
						data-bs-target="#infoModal-{{reservation.id}}"
						data-bs-toggle="tooltip"
						data-bs-placement="top"
						title="تفاصيل"
					>
						<i class="bi bi-info-circle"></i>
					</button>
					<div
						class="modal fade"
						id="infoModal-{{reservation.id}}"
						tabindex="-1"
						aria-labelledby="infoModalLabel"
						aria-hidden="true"
					>
						<div
							class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg"
						>
							<div class="modal-content rounded-0">
								<div class="modal-header">
									<h5 class="modal-title" id="infoModalLabel">
										حجز باسم {{ reservation.user.first_name + ' '
										+reservation.user.last_name }}
									</h5>
									<button
										type="button"
										class="btn-close"
										data-bs-dismiss="modal"
										aria-label="Close"
									></button>
								</div>
								<div class="modal-body">
									<div class="container-fluid">
										<div class="row mb-3">
											<div class="col-md-6">
												<h6 class="d-inline">مالك الحجز</h6>
												:
												<span
													>{{ reservation.user.first_name + ' '
													+reservation.user.last_name }}</span
												>
											</div>
											<div class="col-md-6">
												<h6 class="d-inline">تاريخ الحجز</h6>
												:
												<span>{{ reservation.created_at }}</span>
											</div>
										</div>
										<div class="row mb-3">
											<div class="col-md-6">
												<h6 class="d-inline">تصنيف المالك</h6>
												:
												<span>{{ reservation.user.category.name }}</span>
											</div>
											<div class="col-md-6">
												<h6 class="d-inline">الدفع النقدى</h6>
												: {% if reservation.payment_status.name == 'no_payment'
												%}<span class="badge rounded-0 text-bg-danger"
													>{{ reservation.payment_status.name }}</span
												>
												{% elif reservation.payment_status.name ==
												'down_payment' %}
												<span class="badge rounded-0 text-bg-warning"
													>{{ reservation.payment_status.name }}</span
												>
												{% else %}
												<span class="badge rounded-0 text-bg-success"
													>{{ reservation.payment_status.name }}</span
												>
												{% endif %}
											</div>
										</div>
										<div class="row mb-3">
											<div class="col-md-6">
												<h6 class="d-inline">حجز لـ</h6>
												:
												<span
													>{% if reservation.type.name == 'tool' %} أداة {% else
													%} مساحة {% endif %}</span
												>
												<span
													>{% if reservation.type.name == 'tool' %}
													{{reservation.tool.name}} {% else %}
													{{reservation.space.name}} {% endif %}</span
												>
											</div>
											<div class="col-md-6">
												<h6 class="d-inline">رقم المعاملة البنكية</h6>
												:
												<span class="text-muted">
													{{ reservation.transaction_num if not
													reservation.transaction_num == None else "لم يتم
													التحويل النقدى"}}</span
												>
											</div>
										</div>
										<div class="row mb-3">
											<div class="col-md-6">
												<h6 class="d-inline">قيمة الحجز</h6>
												:
												<span class="text-muted"
													>{{ reservation.full_price }} جنيه مصرى</span
												>
											</div>
										</div>
										<div class="row mb-3">
											<div class="col">
												<h6 class="">ميعاد الحجز</h6>
												{% if reservation.type.name == 'tool' %}
												<ul class="text-muted">
													<li>
														{% if reservation.calendars|length > 1 %} من {{
														reservation.calendars[0].day }} إلى {{
														reservation.calendars[calendars|length - 1].day }}{%
														endif %}
													</li>
												</ul>
												{% else %}
												<ul class="lead text-muted">
													{% for calendar in reservation.calendars %}
													<li>
														<span class="fw-bold me-2">{{calendar.day}}</span>
														من {{ calendar.intervals[0].start_time }} إلى {{
														calendar.intervals[calendar.intervals|length-1].end_time
														}}
													</li>
													{% endfor %}
												</ul>

												{% endif %}
											</div>
											<div class="col-md-6">
												<!-- calender here -->
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<a
						href="{{url_for('dashboard.reservation.change_payment_status', id=reservation.id)}}"
						class="text-white btn btn-warning btn-sm mx-1 rounded-0"
						data-bs-toggle="tooltip"
						data-bs-placement="top"
						title="تغيير حالة"
					>
						<i class="bi bi-pencil"></i>
					</a>
					<form
						method="POST"
						action="{{url_for('dashboard.reservation.delete_reservation', id=reservation.id)}}"
					>
						<button
							type="button"
							class="text-white btn btn-danger btn-sm rounded-0 mx-1"
							data-bs-toggle="modal"
							data-bs-target="#deleteModal-{{reservation.id}}"
							data-bs-toggle="tooltip"
							data-bs-placement="top"
							title="حذف"
						>
							<i class="bi bi-trash3"></i>
						</button>
						<div
							class="modal fade"
							id="deleteModal-{{reservation.id}}"
							tabindex="-1"
							aria-labelledby="deleteModalLabel"
							aria-hidden="true"
						>
							<div class="modal-dialog">
								<div class="modal-content rounded-0">
									<div class="modal-header">
										<h5 class="modal-title" id="deleteModalLabel">حذف!</h5>
										<button
											type="button"
											class="btn-close"
											data-bs-dismiss="modal"
											aria-label="Close"
										></button>
									</div>
									<div class="modal-body">هل أنت متأكد من حذف الحجز:</div>
									<div class="modal-footer">
										<button
											type="button"
											class="btn btn-sm rounded-0 btn-outline-secondary"
											data-bs-dismiss="modal"
										>
											رجوع
										</button>
										<button type="submit" class="btn btn-sm rounded-0 btn-danger">
											تأكيد الحذف
										</button>
									</div>
								</div>
							</div>
						</div>
					</form>
				</td>
			</tr>
			
			{% endif %}
			{% endfor %}
		</tbody>
	</table>
	<nav aria-label="Page navigation example" class="d-flex float-end">
		<ul class="pagination ">
		  <li class="page-item"><button class="page-link" name="Previous" value="Previous" type="submit">Previous</button></li>
		  {% for page in range(1 , pages+1) %}
		  <li class="page-item"><button class="page-link" name="b" value="{{page}}">{{page}}</button></li>
		  {% endfor %}
		  <li class="page-item"><button class="page-link" name="next" value="next" >next</button></li>
		</ul>
	  </nav>
	</form>
</div>
{% endblock %}
